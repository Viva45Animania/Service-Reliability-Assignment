<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Service Health Dashboard</title>
    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }

        h1 {
            margin-bottom: 10px;
        }

        .meta {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 20px;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            background: #fff;
        }

        th, td {
            padding: 8px 10px;
            border-bottom: 1px solid #ddd;
            text-align: left;
            font-size: 0.9rem;
        }

        th {
            background-color: #f0f0f0;
        }

        tr:hover {
            background-color: #f9f9f9;
        }

        .status-UP {
            color: #0a7d2b;
            font-weight: 600;
        }

        .status-DOWN {
            color: #c0392b;
            font-weight: 600;
        }

        .status-UNKNOWN {
            color: #888;
            font-weight: 600;
        }

        .chip {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.75rem;
            background-color: #eee;
        }

        .chip-env-production {
            background-color: #ffe5e5;
        }

        .chip-env-staging {
            background-color: #e5f0ff;
        }

        .chip-env-uat {
            background-color: #e5ffe9;
        }

        .version-drift {
            color: #e67e22;
            font-size: 0.8rem;
        }

        .version-ok {
            color: #2c3e50;
            font-size: 0.8rem;
        }

        .latency {
            font-variant-numeric: tabular-nums;
        }

        .empty-state {
            margin-top: 40px;
            color: #777;
            font-size: 0.95rem;
        }
    </style>
</head>
<body>
    <h1>Service Health Dashboard</h1>
    <div class="meta">
        Showing latest health status for all monitored services.
    </div>

    {% if services %}
        <table>
            <thead>
                <tr>
                    <th>Service</th>
                    <th>Environment</th>
                    <th>Status</th>
                    <th>Latency (ms)</th>
                    <th>Version</th>
                    <th>Last Checked</th>
                </tr>
            </thead>
            <tbody>
            {% for svc in services %}
                <tr>
                    <td>
                        <strong>{{ svc.name }}</strong><br>
                        <span style="font-size: 0.8rem; color: #777;">
                            ID: {{ svc.serviceId }}
                        </span>
                    </td>
                    <td>
                        {% set env = svc.environment.lower() %}
                        <span class="chip chip-env-{{ env }}">
                            {{ svc.environment | capitalize }}
                        </span>
                    </td>
                    <td>
                        <span class="status-{{ svc.status }}">
                            {{ svc.status }}
                        </span>
                    </td>
                    <td class="latency">
                        {% if svc.latencyMs is not none %}
                            {{ svc.latencyMs }}
                        {% else %}
                            &mdash;
                        {% endif %}
                    </td>
                    <td>
                        {% if svc.version %}
                            <div>
                                {{ svc.version }}
                            </div>
                            {% if svc.versionMatchesExpected is not none %}
                                {% if svc.versionMatchesExpected %}
                                    <div class="version-ok">
                                        ✓ expected
                                    </div>
                                {% else %}
                                    <div class="version-drift">
                                        ⚠ drift
                                    </div>
                                {% endif %}
                            {% endif %}
                        {% else %}
                            <span style="color:#aaa; font-size:0.8rem;">n/a</span>
                        {% endif %}
                    </td>
                    <td>
                        {{ svc.lastCheckedAt }}
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    {% else %}
        <div class="empty-state">
            No services with health data yet. Check that your configuration file is loaded and that
            the scheduler has run at least one cycle.
        </div>
    {% endif %}
</body>
</html>
